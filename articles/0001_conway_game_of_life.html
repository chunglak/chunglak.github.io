<!DOCTYPE html>
<html lang="en">
<head>
<!-- Mon 20 April 2020 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fun with Conway's game of life</title>
<meta name="generator" content="Org mode">
<link rel="stylesheet" type="text/css" href="/css/site.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/index.html"> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="preamble" class="status">
<br/>
</div>
<div id="content">
<header>
<h1 class="title">Fun with Conway's game of life</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga2147f9">The Rules of the Game</a></li>
<li><a href="#org8a979f1">Implementation in python</a></li>
<li><a href="#org6cbb351">Regenerate the xkcd drawing</a></li>
<li><a href="#orgb6f1bf5">Make a GIF from a photo</a></li>
<li><a href="#orga963ba5">Further things to explore</a>
<ul>
<li><a href="#org1b8835b">Refine image conversion algorithm to black-and-white</a></li>
<li><a href="#orga551eaa">Make a javascript application to allow users to process an image of their choice into a GIF</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div class="page-date">
<p>
Thu 16 April 2020<br>
</p>

</div>
<div class="abstract">
<p>
<a href="https://en.wikipedia.org/wiki/John_Horton_Conway">John Conway</a> passed away last week, on April 11th, 2020. To laymen and computer enthusiasts, he is probably best remembered for inventing in 1970 a cellular automaton that could, from very simple rules, sometimes exhibit almost life-like patterns. What better way to celebrate his life than with the <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Game of Life</a>?<br>
</p>

</div>
<p>
<br>
</p>

<div style="text-align:center">
  <div>
    <img
      style="width:200px"
      src="https://imgs.xkcd.com/comics/rip_john_conway.gif"
      >
  </div>
  <div>
    <a href="https://xkcd.com/2293">
      Obligatory xkcd
    </a>
  </div>
</div>

<p>
For a whole generation of young computer enthusiasts coming of age at the beginning of the 1980s, coding Conway's game of life on a home computer and watch the patterns evolving and seeming to acquire a life of their own has been an unforgettable experience. How such simple rules could produce such rich and complex results was simply mind-boggling.<br>
So, to honor the memory of the great man, let's delve once again into this fascinating world.<br>
</p>

<div id="outline-container-orga2147f9" class="outline-2">
<h2 id="orga2147f9">The Rules of the Game</h2>
<div class="outline-text-2" id="text-orga2147f9">
<p>
From the <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Wikipedia page</a>,<br>
</p>
<blockquote>
<p>
The universe of the Game of Life is an infinite, two-dimensional orthogonal grid of square cells, each of which is in one of two possible states, alive or dead, (or populated and unpopulated, respectively). Every cell interacts with its eight neighbours, which are the cells that are horizontally, vertically, or diagonally adjacent. At each step in time, the following transitions occur:<br>
</p>

<ul class="org-ul">
<li>Any live cell with fewer than two live neighbours dies, as if by underpopulation.<br></li>
<li>Any live cell with two or three live neighbours lives on to the next generation.<br></li>
<li>Any live cell with more than three live neighbours dies, as if by overpopulation.<br></li>
<li>Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.<br></li>
</ul>

<p>
These rules, which compare the behavior of the automaton to real life, can be condensed into the following:<br>
</p>
<ul class="org-ul">
<li>Any live cell with two or three live neighbors survives.<br></li>
<li>Any dead cell with three live neighbors becomes a live cell.<br></li>
<li>All other live cells die in the next generation. Similarly, all other dead cells stay dead.<br></li>
</ul>

<p>
The initial pattern constitutes the seed of the system. The first generation is created by applying the above rules simultaneously to every cell in the seed; births and deaths occur simultaneously, and the discrete moment at which this happens is sometimes called a tick. Each generation is a pure function of the preceding one. The rules continue to be applied repeatedly to create further generations.<br>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org8a979f1" class="outline-2">
<h2 id="org8a979f1">Implementation in python</h2>
<div class="outline-text-2" id="text-org8a979f1">
<p>
OK, let's see if we can implement the game simply. We'll be using <a href="https://numpy.org/">NumPy</a>, the standard scientific package for python, as it make manipulating arrays fast and easy.<br>
The best way to follow this article is to type in the code in a REPL like <a href="https://jupyter.org/">Jupyter notebook</a> so that you can play around.<br>
</p>

<p>
The grid is simply a 2-d numpy array of booleans (<code>False</code> if cell is dead, <code>True</code> if cell is alive).<br>
</p>
<div class="org-src-container">
<pre class="src src-python">import numpy as np

def make_grid(Y,X):
    return np.zeros((Y,X),dtype=bool)

grid=make_grid(5,6)
grid
</pre>
</div>

<pre class="example">
array([[False, False, False, False, False, False],
       [False, False, False, False, False, False],
       [False, False, False, False, False, False],
       [False, False, False, False, False, False],
       [False, False, False, False, False, False]])
</pre>


<p>
To spice things up a bit, a function to set cells on randomly<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def set_on_random_cells(grid, n):
    import random

    _grid = grid.reshape((-1,))
    _grid[np.random.choice(_grid.size, n, replace=False)] = True
    return _grid.reshape(grid.shape)

grid = set_on_random_cells(grid, 15)
grid
</pre>
</div>

<pre class="example">
array([[False, False, False,  True, False,  True],
       [False, False, False,  True, False,  True],
       [ True, False,  True,  True, False,  True],
       [ True,  True, False,  True, False, False],
       [ True,  True,  True,  True, False, False]])
</pre>


<p>
Mmm&#x2026; the display is not very pretty. Can we do better?<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def display_grid(grid):
    return '\n'.join(''.join('■' if c else '□' for c in row) for row in grid)

print(display_grid(grid))
</pre>
</div>

<pre class="example">
□□□■□■
□□□■□■
■□■■□■
■■□■□□
■■■■□□
</pre>


<p>
That's better, but we'll improve on that later on.<br>
On to the main function, which computes the new grid from the old grid. It's not going to win any prize for cleverness, but it's a straightforward implementation of the algorithm and it's easy to see it works well.<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def calc_grid(grid):
    def nb_neighbors(y, x):
        nn = 0
        for dx in (-1, 0, 1):
            for dy in (-1, 0, 1):
                if dx == dy == 0:
                    continue
                xp, yp = x + dx, y + dy
                if xp &gt;= 0 and yp &gt;= 0 and xp &lt; X and yp &lt; Y and grid[yp, xp]:
                    nn += 1
        return nn

    Y, X = grid.shape
    new_grid = make_grid(Y, X)
    for y in range(Y):
        for x in range(X):
            nbn = nb_neighbors(y, x)
            v = grid[y, x]
            if v:
                new_grid[y, x] = 2 &lt;= nbn &lt;= 3
            elif nbn == 3:
                new_grid[y, x] = True
    return new_grid


grid = calc_grid(grid)
print(display_grid(grid))
</pre>
</div>

<pre class="example">
□□□□□□
□□□■□■
■□□■□□
□□□□□□
■□□■□□
</pre>
</div>
</div>

<div id="outline-container-org6cbb351" class="outline-2">
<h2 id="org6cbb351">Regenerate the xkcd drawing</h2>
<div class="outline-text-2" id="text-org6cbb351">
<p>
For fun, how about replicating the xkcd animation at the top of the page? We copy the initial cells into an array that we embed inside a bigger grid.<br>
</p>

<div class="org-src-container">
<pre class="src src-python">conway = np.array(
    [
        [0, 0, 1, 1, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [1, 0, 1, 1, 1, 0, 0],
        [0, 1, 0, 1, 0, 1, 0],
        [0, 0, 0, 1, 0, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [0, 0, 1, 0, 1, 0, 0],
    ]
)

grid = make_grid(20, 17)
x0, y0 = 5, 8
grid[y0 : y0 + conway.shape[0], x0 : x0 + conway.shape[1]] = conway
print(display_grid(grid))
</pre>
</div>

<pre class="example">
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□■■■□□□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□□□■□□□□□□□□
□□□□□■□■■■□□□□□□□
□□□□□□■□■□■□□□□□□
□□□□□□□□■□□■□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
</pre>


<p>
Not too bad, eh? Now, with the snippet below, we can evolve the grid.<br>
</p>

<div class="org-src-container">
<pre class="src src-python">grid = calc_grid(grid)
print(display_grid(grid))
</pre>
</div>

<pre class="example">
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□■□□□□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□■■□■■□□□□□□
□□□□□□□■□■□□□□□□□
□□□□□□■□□□□□□□□□□
□□□□□□■□□□□□□□□□□
□□□□□□■□□□■□□□□□□
□□□□□□□□■□■□□□□□□
□□□□□□□■□■■□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
□□□□□□□□□□□□□□□□□
</pre>


<p>
That's the grid's final position. It gets stuck at the edge of the frame it the 4-cell square is stable. Guess xkcd clipped the frame so that the pattern diseappears&#x2026; Oh well.<br>
</p>
</div>
</div>

<div id="outline-container-orgb6f1bf5" class="outline-2">
<h2 id="orgb6f1bf5">Make a GIF from a photo</h2>
<div class="outline-text-2" id="text-orgb6f1bf5">
<p>
Now onto something more exciting: how about we digitize a photo into a grid and play the game of life with that initial pattern?<br>
</p>

<p>
Let's find a <a href="https://en.wikipedia.org/wiki/File:John_H_Conway_2005_(cropped).jpg">photo</a> to use<br>
</p>

<figure>
<img src="../images/2020-04-19_22-28-14_720px-John_H_Conway_2005_(cropped).jpg" alt="John Conway" width="50%"><br>

</figure>

<p>
We can easily load, resize and convert it with the <a href="https://pillow.readthedocs.io/en/stable/">Python Imaging Library</a>.<br>
</p>
<div class="org-src-container">
<pre class="src src-python">from PIL import Image

fn='../images/2020-04-19_22-28-14_720px-John_H_Conway_2005_(cropped).jpg'
im=Image.open(fn)
w,h=im.size
W=250
im=im.resize((W,int(W*h/w)))
im=im.convert('1')
im
</pre>
</div>


<figure>
<img src="./ob-jupyter/1cac41bc0f0ca07671ddd3bb830ddba8370164a7.png" alt="1cac41bc0f0ca07671ddd3bb830ddba8370164a7.png"><br>

</figure>

<p>
Let's create a function to create a grid from a photo<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def make_grid_from_image(fn, width=None):
    im = Image.open(fn)
    if width:
        w, h = im.size
        im = im.resize((width, int(width / w * h)))
    im = im.convert("1")
    w,h=im.size
    flat_grid=np.logical_not(np.array(im.getdata()))
    grid=flat_grid.reshape((h,w))
    return grid
</pre>
</div>

<p>
To accomodate larger size, let's rewrite our <code>display_grid</code> function to produce an image instead of text<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def display_image_from_grid(grid):
    Y,X=grid.shape
    im=Image.new(mode='1',size=(X,Y))
    im.putdata(np.logical_not(grid.reshape((-1,))))
    return im

grid=make_grid_from_image(fn,250)
display_image_from_grid(grid)
</pre>
</div>


<figure>
<img src="./ob-jupyter/1cac41bc0f0ca07671ddd3bb830ddba8370164a7.png" alt="1cac41bc0f0ca07671ddd3bb830ddba8370164a7.png"><br>

</figure>

<p>
We can now evolve the image just like before<br>
</p>
<div class="org-src-container">
<pre class="src src-python">grid=calc_grid(grid)
display_image_from_grid(grid)
</pre>
</div>


<figure>
<img src="./ob-jupyter/911fd06e85f53702f001f63ec3206f101705cd41.png" alt="911fd06e85f53702f001f63ec3206f101705cd41.png"><br>

</figure>

<p>
And now, saving the animation as a GIF file!<br>
</p>
<div class="org-src-container">
<pre class="src src-python">def make_gif_from_grid(grid, fn, nb_frames=100, duration=250):
    im0 = display_image_from_grid(grid)
    ims = []
    for _ in range(nb_frames):
        grid = calc_grid(grid)
        # Need to convert image to "p" otherwise PIL complains about palette missing
        ims.append(display_image_from_grid(grid).convert("P"))

    im0.convert("P").save(
        fn, save_all=True, append_images=ims, duration=duration, loop=0
    )

import os.path
gfn=os.path.join(os.path.dirname(fn),'conway.gif')
grid=make_grid_from_image(fn,250)
make_gif_from_grid(grid,gfn)
</pre>
</div>

<p>
Et voilà!<br>
</p>


<figure>
<img src="../images/conway.gif" alt="conway.gif"><br>

</figure>
</div>
</div>

<div id="outline-container-orga963ba5" class="outline-2">
<h2 id="orga963ba5">Further things to explore</h2>
<div class="outline-text-2" id="text-orga963ba5">
</div>
<div id="outline-container-org1b8835b" class="outline-3">
<h3 id="org1b8835b">Refine image conversion algorithm to black-and-white</h3>
<div class="outline-text-3" id="text-org1b8835b">
<p>
One disappointing thing with the photo is that the features vanish almost instantly because of the density of the dark parts of the image (remember the algorithm, more than 3 is overcrowding!).<br>
It would be interesting to adjust at a pixel level how the conversion is done so that we can manually create islands of stability in the darker parts, slowing down the vanishing.<br>
</p>
</div>
</div>
<div id="outline-container-orga551eaa" class="outline-3">
<h3 id="orga551eaa">Make a javascript application to allow users to process an image of their choice into a GIF</h3>
<div class="outline-text-3" id="text-orga551eaa">
<p>
Shouldn't be too difficult to do, plus with all the processing done on the client side, no issue of privacy or server muscle needed.<br>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<br/><br/><br/>
<div class='postamble'>
<span><a href='/index.html'>Considérations inactuelles</a> is the blog of <a href='mailto:chunglak@gmail.com'>Alfred Leung - 梁宗力</a></span>
<br> <span>Updated on Mon 20 April 2020</span> 
</div>
</div>
</body>
</html>
